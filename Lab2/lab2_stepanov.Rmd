---
title: "Лабораторная работа №2"
author: "Степанов Г.А."
date: "`r format(Sys.Date(), '%d  %B  %Y')`"
output: 
  word_document: 
    reference_docx: word_styles.docx
---

```{r setup, include = FALSE}

# Загрузка библиотек
library('knitr')
library('stats') 
#library('Hmisc')          # для расчёта корреляционной матрицы
#library('corrplot')       # визуализация корреляционных матриц: corrplot()
#library('nortest')        # для теста Андерсона-Дарлинга ad.test()
knitr::opts_chunk$set(echo = FALSE)

#счётчик для таблиц
table.num <- 1

#счётчик для рисунков
pic.num <- 1

```


## Импорт данных

Импортируем объекты, сохранённые в рабочем пространстве по итогу лабораторной №1.

```{r}
# загрузка объектов из сохранённого рабочего пространства
load('test_lab1_Степанов.RData')

# просмотр списка объектов
ls()


# Информация по переменной reg.df
#str(reg.df)



```
# Раздел I.

## Изначальная регрессионная модель, основанная на Лабораторной №1
Модель 0: $Y = 562,2590 + 0,0026 \cdot X1 + 0,1478\cdot X2 -0,0193\cdot X3+ 12,4401\cdot X4$, где


* `Y` `SREDDENDOXOD2012` – Среднедушевые денежные доходы населения.   

* `X1` `VRP2012` – ВРП на душу населения.   

* `X2` `Y.ORTorg.2012` –Оборот розничной торговли на душу населения.   

* `X3` `RKBS.2011` – Расходы консолидированных бюджетов субъектов Российской Федерации: на социальную политику.   

* `X4` `KMPred.2012` – Число малых предприятий на 10000 человек населения.


По количеству `r nrow(reg.df)`-x наблюдений.

## Оценка параметров этой модели

#### Таблица `r table.num` - описательные статистики модели 0
```{r}
# множественная регрессия для всех регионов
fit.1 <- lm(SREDDENDOXOD2012 ~ VRP2012 + Y.ORTorg.2012+RKBS.2011+KMPred.2012, 
            data = reg.df)
kable(round(summary(fit.1)$coef, 4))
table.num <- table.num + 1
#summary(fit.1) # незначимые параметры
#str(summary(fit.1))
#построим график
par(mfrow = c(2, 2))
plot(SREDDENDOXOD2012 ~ VRP2012 + Y.ORTorg.2012+RKBS.2011+KMPred.2012, 
         data = reg.df)
par(mfrow = c(1, 1))
pic.num <- pic.num + 1

```

#### Рис. `r pic.num`. график разброса начальной модели


**Проверка значимости для коэффициента при VRP2012.**

H0: (параметр) коэфф. при VRP2012 равен 0 в генеральной совокупности (не значим);

H1: (параметр) коэфф. при VRP2012 не равен 0 в генеральной совокупности (значим).

Проверим значимость при помощи p-значения.

**Напоминание:**
*Сравниваем p-значение и $\alpha$ (Уровень значимости = 0,05);*
*Если p-значение > $\alpha$, то принимается гипотеза H0, в ином случае принимается противоположная гипотеза H1.*

P-значение при VRP2012 = $0.1201>\alpha$ => принимается гипотеза H0. **Параметр незначим.**

**Проведём похожую проверку коэффициента при Y.ORTorg.2012.**

P-значение при Y.ORTorg.2012 = $0,0000<\alpha$ => принимается гипотеза H1. **Параметр значим.**

**Проведём похожую проверку коэффициента при RKBS.2011.**

P-значение при RKBS.2011 = $0,6023>\alpha$ => принимается гипотеза H0. **Параметр незначим.**

**Проведём похожую проверку коэффициента при KMPred.2012.**

P-значение при KMPred.2012 = $0,4090>\alpha$ => принимается гипотеза H0. **Параметр незначим.**

Есть незначимые параметры, будем исключать их последовательно. $R^2 =$ `r round(summary(fit.1)$r.sq, 3)`. 49,59% исходного разброса зависимой переменной Y (Среднедушевые денежные доходы населения) объясняет разброс объясняющих переменных X1 (ВРП на душу населения), X2 (Оборот розничной торговли на душу населения), x3(Расходы консолидированных бюджетов субъектов Российской Федерации: на социальную политику). X4(Число малых предприятий на 10000 человек населения).

## Пошаговое исключение регрессоров

Исключаем RKBS.2011 первым так как у него самое большое p-значение(0,6023).

#### Таблица `r table.num` - описательные статистики модели после исключения 1

```{r}
fit.1 <- lm(SREDDENDOXOD2012 ~ VRP2012 + Y.ORTorg.2012+KMPred.2012, 
            data = reg.df)
kable(round(summary(fit.1)$coef, 4))
table.num <- table.num + 1
#summary(fit.1) # незначимые параметры
```
После исключения RKBS.2011 у нас остались p-значения больше $\alpha$.Удаляем следущий коэффицент при KMPred.2012,так как p-значение равно 0,35.

#### Таблица `r table.num` - описательные статистики модели после исключения 2

```{r}
fit.1 <- lm(SREDDENDOXOD2012 ~ VRP2012 + Y.ORTorg.2012, 
            data = reg.df)
kable(round(summary(fit.1)$coef, 4))
table.num <- table.num + 1
#summary(fit.1) # незначимые параметры
```

После исключения KMPred.2012 у нас остались p-значения больше $\alpha$.Удаляем следущий коэффицент при VRP2012,так как p-значение равно 0,1031.

#### Таблица `r table.num` - описательные статистики модели 1

```{r}
fit.1 <- lm(SREDDENDOXOD2012 ~  Y.ORTorg.2012, 
            data = reg.df)
kable(round(summary(fit.1)$coef, 4))
table.num <- table.num + 1
#summary(fit.1) # незначимые параметры
```

Значим только х2(Y.ORTorg.2012).Коэффициент детерминации $R^2 =$ `r round(summary(fit.1)$r.sq, 3)`.


Явный вид модели 1: $SREDDENDOXOD2012 = 1161,8586 + 0,1606 \cdot Y.ORTorg.2012$.
```{r}
plot(SREDDENDOXOD2012 ~  Y.ORTorg.2012, 
         data = reg.df)
pic.num <- pic.num + 1

```



#### Рис. `r pic.num`. график разброса исправленной модели


## Модель с переменной структурой по федеральным округам.

Построим модель с переменной структурой, используя принадлежность каждого региона к одному из восьми федеральных округов.
Включим фиктивные переменные как в константу, так и в коэффициенты.
Общий вид модели с переменной структурой.

#### Таблица `r table.num` - описательные статистики модели по федеральным округам
```{r}

fit.1.fo <- lm(SREDDENDOXOD2012 ~ FO * Y.ORTorg.2012, 
            data = reg.df) 
kable(round(summary(fit.1.fo)$coef, 2))
#summary(fit.1.fo)
table.num <- table.num + 1

```

Модель в целом незначима, но скорректированный коэффициент
детерминации у неё выше, чем у модели по всем регионам (`r round(summary(fit.1.fo)$r.sq, 3)*100`%). У неё много незначимых параметров.
Исключать их последовательно вручную трудоёмко, поэтому мы воспользуемся пользовательской функцией, которая
проводит процедуру последовательного исключения регрессоров.

Сначала сгенерируем матрицу независимых переменных функцией
*model.matrix()*. После загружаем функцию для исключения незначимых регрессоров
из файла «removeFactorsByPValue.R» в рабочей директории и применяем её
к модели с переменной структурой.

### Модель без поправки:


#### Таблица `r table.num` - описательные статистики модели по федеральным округам без поправки
```{r}
# создаём фрейм со всеми переменными-факторами (создаём фиктивные)
X.matrix <- model.matrix(SREDDENDOXOD2012 ~ FO * Y.ORTorg.2012, 
            data = reg.df)

# присоединяем независимую переменную
data.fit <- cbind(SREDDENDOXOD2012 = reg.df$SREDDENDOXOD2012, 
                  data.frame(X.matrix)[, -1])

# сохраняем для следующей лабораторной
data.fit.1.fo <- data.fit

# функция с последовательным исключением незначимых регрессоров
source('https://raw.githubusercontent.com/aksyuk/R-Practice-basics/master/user_functions/removeFactorsByPValue.R')

# применяем процедуру, сначала без поправок на p-значения
fit.1.fo <- removeFactorsByPValue(data = data.fit, 
                                   y.var.name = 'SREDDENDOXOD2012')
kable(round(summary(fit.1.fo)$coef, 4))
table.num <- table.num + 1
#summary(fit.1.fo)

```


Все коэффициенты модели значимы и она имеет средний уровень коэффициента детерминации. ($R^2 =$ `r round(summary(fit.1.fo)$r.sq, 3)`)

Значимы константы для Приволжского, Южного,  Северо-Западного, Северо-Кавказского и Центрального федеральных
округов.

Явный вид Модели 2:$SREDDENDOXOD2012 = 8506,7907 + 0,1385 \cdot Y.ORTorg.2012 - 6816,8680\cdot FOПФО -5951,6333\cdot FOСКФО - 6396,3031\cdot FOСФО-6459.9793\cdot FOЦФО - 8416,3114\cdot FOЮФО$


### Модель с поправкой Бонферрони:



#### Таблица `r table.num` - описательные статистики модели по федеральным округам с поправкой Бонферрони
```{r}
# теперь с поправкой Бонферрони
fit.1.foB <- removeFactorsByPValue(data = data.fit, 
                                   y.var.name = 'SREDDENDOXOD2012',
                                   p.adj.method = 'bonferroni')
kable(round(summary(fit.1.foB)$coef, 4))
table.num <- table.num + 1
#summary(fit.1.foB)
```
Коэффициент модели при *FOСЗФО.Y.ORTorg.2012*,*FOУФО.Y.ORTorg.2012* значим, однако коэффициент детерминации заметно понизился ($R^2 =$ `r round(summary(fit.1.foB)$r.sq, 3)`).


# строим ПЛР на второй по силе корреляции фактор

Построим модель с переменной структурой, используя принадлежность каждого региона к одному из восьми федеральных округов.
Включим фиктивные переменные как в константу, так и в коэффициенты.
Общий вид модели с переменной структурой.



```{r}
# строим ПЛР на второй по силе корреляции фактор
fit.X2 <- lm(SREDDENDOXOD2012 ~ VRP2012, 
             data = reg.df)
#summary(fit.X2)
```
Модель со 2 фактором по силе корреляции значима, но имеет слабый коэффицент детерминации ($R^2 =$ `r round(summary(fit.X2)$r.sq, 3)`)

#### Таблица `r table.num` - описательные статистики модели по федеральным округам
```{r}

fit.x2.fo <- lm(SREDDENDOXOD2012 ~ FO * VRP2012, 
            data = reg.df) 
kable(round(summary(fit.x2.fo)$coef, 4))
#summary(fit.x2.fo)
table.num <- table.num + 1

```

Модель в целом незначима, но скорректированный коэффициент
детерминации у неё выше, чем у модели по всем регионам (`r round(summary(fit.1.fo)$r.sq, 3)*100`%). У неё много незначимых параметров.
Исключать их последовательно вручную трудоёмко, поэтому мы воспользуемся пользовательской функцией, которая
проводит процедуру последовательного исключения регрессоров.

Сначала сгенерируем матрицу независимых переменных функцией
*model.matrix()*. После загружаем функцию для исключения незначимых регрессоров
из файла «removeFactorsByPValue.R» в рабочей директории и применяем её
к модели с переменной структурой.

### Модель без поправки:


#### Таблица `r table.num` - описательные статистики модели по федеральным округам без поправки
```{r}
# создаём фрейм со всеми переменными-факторами (создаём фиктивные)
X.matrix <- model.matrix(SREDDENDOXOD2012 ~ FO * VRP2012, 
            data = reg.df)

# присоединяем независимую переменную
data.fit <- cbind(SREDDENDOXOD2012 = reg.df$SREDDENDOXOD2012, 
                  data.frame(X.matrix)[, -1])

# сохраняем для следующей лабораторной
data.fit.x2.fo <- data.fit

# функция с последовательным исключением незначимых регрессоров
source('https://raw.githubusercontent.com/aksyuk/R-Practice-basics/master/user_functions/removeFactorsByPValue.R')

# применяем процедуру, сначала без поправок на p-значения
fit.x2.fo <- removeFactorsByPValue(data = data.fit, 
                                   y.var.name = 'SREDDENDOXOD2012')
kable(round(summary(fit.x2.fo)$coef, 4))
table.num <- table.num + 1
#summary(fit.x2.fo)

```
Все коэффициенты модели значимы и она имеет средний уровень коэффициента детерминации. ($R^2 =$ `r round(summary(fit.x2.fo)$r.sq, 3)`)

Значимы константы для   Северо-Западного, Уральского федеральных
округов, а также коэффициенты при независимых переменных для некоторых округов.

*(VRP2012 с  Северо-Западном и Уральским Федеральными округами)*


Явный вид Модели 5:$SREDDENDOXOD2012 = 11472,1156 + 0,0304 \cdot VRP2012 + 14328,9432\cdot FOСЗФО + 14616,3735\cdot FOУФО	 - 0,0310\cdot FOСЗФО.VRP2012	-0,0249\cdot FOУФО.VRP2012$


### Модель с поправкой Бонферрони:



#### Таблица `r table.num` - описательные статистики модели по федеральным округам с поправкой Бонферрони
```{r}
# теперь с поправкой Бонферрони
fit.x2.foB <- removeFactorsByPValue(data = data.fit, 
                                   y.var.name = 'SREDDENDOXOD2012',
                                   p.adj.method = 'bonferroni')
kable(round(summary(fit.x2.foB)$coef, 4))
table.num <- table.num + 1
#summary(fit.x2.foB)
```
Коэффициент модели при *VRP2012*,*FOСЗФО.VRP2012* значим, однако коэффициент детерминации заметно понизился ($R^2 =$ `r round(summary(fit.x2.foB)$r.sq, 3)`).


## Сравнение моделей по качеству.

Сравним три полученные модели: изначальную, с поправкой по ФО и без поправки по ФО.


#### Таблица `r table.num` - сравнение трёх моделей
```{r}
# модели с фактором Y.ORTorg.2012
#anova(fit.1, fit.1.foB, fit.1.fo)
# модели с фактором Y.ORTorg.2012
#anova(fit.x2, fit.x2.foB, fit.x2.fo)

# список построенных моделей
models.list <- list(fit.1, fit.1.foB, fit.1.fo, fit.X2, fit.x2.foB, fit.x2.fo)
names(models.list) <- c('fit.1', 'fit.1.foBonferroni', 'fit.1.fo' , 'fit.x2', 'fit.x2.foB', 'fit.x2.fo')

# фрейм с характеристиками четырёх моделей
df.goodness.of.fit <- data.frame(Модель = names(models.list), 
                                       R.2.скорр = 0,
                                       F.расч = 0,
                                       Станд.Ошибка = 0)
for (i in 1:length(models.list)) {
  # скорректированный R-квадрат
  df.goodness.of.fit[i, 'R.2.скорр'] <- 
    round(summary(models.list[[i]])$adj.r.squared, 3)
  # F расчётное
  df.goodness.of.fit[i, 'F.расч'] <- 
    round(summary(models.list[[i]])$fstatistic[1], 2)
  # стандартная ошибка
  df.goodness.of.fit[i, 'Станд.Ошибка'] <- 
    round(summary(models.list[[i]])$sigma, 1)
}
kable(df.goodness.of.fit)
table.num <- table.num + 1

#mean(reg.df$SREDDENDOXOD2012) 
```

Результат: 

Среднее по Y = 21244.39 (~ 16% стандартной ошибки);

По столбцу $R^2$ больше всего подходит  первая и третья, шестая модель;
По столбцу F.расч - первая и третья;
По минимальной Стандартной ошибке - первая,третья и шестая.

Таким образом, модели по федеральным округам без поправки и х2 (fit.1.fo,fit.1) наиболее предпочтительны.

**Явный вид Модели fit.1.fo:$SREDDENDOXOD2012 = 8506,7907 + 0,1385 \cdot Y.ORTorg.2012 - 6816,8680\cdot FOПФО -5951,6333\cdot FOСКФО - 6396,3031\cdot FOСФО-6459.9793\cdot FOЦФО - 8416,3114\cdot FOЮФО$ **

**Явный вид модели fit.1: $SREDDENDOXOD2012 = 1161,8586 + 0,1606 \cdot Y.ORTorg.2012$.**


* * *

* * *



# Раздел II.

## Изначальная регрессионная модель для логарифмированных данных, основанная на Лабораторной №1
Модель 0: $Y = 0.9236 -0.0061 \cdot X1 - 0.0344\cdot X2+0.5772\cdot X3+0.2059\cdot X4$, где

* `Y` `SREDDENDOXOD2012` – Среднедушевые денежные доходы населения.   

* `X1` `VRP2012` – ВРП на душу населения.   

* `X2` `Y.ORTorg.2012` –Оборот розничной торговли на душу населения.   

* `X3` `RKBS.2011` – Расходы консолидированных бюджетов субъектов Российской Федерации: на социальную политику.   

* `X4` `KMPred.2012` – Число малых предприятий на 10000 человек населения.

По количеству `r nrow(DF1)`-x наблюдений.

## Оценка параметров этой модели


#### Таблица `r table.num` - описательные статистики логарифмированной модели 1

```{r}
# множественная регрессия для всех регионов на логарифмированных данных
fit.11 <- lm(SREDDENDOXOD2012 ~ KMPred.2012 + RKBS.2011+Y.ORTorg.2012+VRP2012, 
            data = DF1)
kable(round(summary(fit.11)$coef, 4))  # незначимые параметры
table.num <- table.num + 1
#построим график
par(mfrow = c(2, 2))
plot(SREDDENDOXOD2012 ~  KMPred.2012 + RKBS.2011+Y.ORTorg.2012+VRP2012, 
            data = DF1)
par(mfrow = c(1, 1))
#summary(fit.11)
pic.num <- pic.num + 1
```

#### Рис. `r pic.num`. график разброса начальной логарифмированной модели

## Проверка значимости для логарифмированных значений:

**Проверка значимости для коэффициента при KMPred.2012.**

H0: (параметр) коэфф. при KMPred.2013 равен 0 в генеральной совокупности (не значим);

H1: (параметр) коэфф. при KMPred.2013 не равен 0 в генеральной совокупности (значим).

Проверим значимость при помощи p-значения. ( $\alpha = 0,05$ )
P-значение при KMPred.2012 = $0.9193>\alpha$ => принимается гипотеза H0. **Параметр незначим.**

**Проведём похожую проверку коэффициента при RKBS.2011.**

P-значение при RKBS.2011 = $0.2609>\alpha$ => принимается гипотеза H0. **Параметр незначим.**

**Проведём похожую проверку коэффициента при Y.ORTorg.2012.**

P-значение при Y.ORTorg.2012 = $0.0000<\alpha$ => принимается гипотеза H1. **Параметр значим.**

**Проведём похожую проверку коэффициента при VRP2012.**

P-значение при VRP2012 = $0.000<\alpha$ => принимается гипотеза H1. **Параметр значим.**

Есть незначимые параметры, будем исключать их последовательно. $R^2 =$ `r round(summary(fit.1)$r.sq, 3)`. 66.45% исходного разброса зависимой переменной Y (Среднедушевые денежные доходы населения) объясняет разброс объясняющих переменных X1 (ВРП на душу населения), X2 (Оборот розничной торговли на душу населения), x3(Расходы консолидированных бюджетов субъектов Российской Федерации: на социальную политику). X4(Число малых предприятий на 10000 человек населения).

## Пошаговое исключение регрессоров

Исключаем KMPred.2012 первым так как у него самое большое p-значение(0,9193).

#### Таблица `r table.num` - описательные статистики модели после исключения 1

```{r}
fit.11 <- lm(SREDDENDOXOD2012 ~ VRP2012 + Y.ORTorg.2012+RKBS.2011, 
            data = DF1)
kable(round(summary(fit.11)$coef, 4))
table.num <- table.num + 1
#summary(fit.11) # незначимые параметры
```
После исключения KMPred.2012 у нас остались p-значения больше $\alpha$.Удаляем следущий коэффицент при RKBS.2011,так как p-значение равно 0,2597.

#### Таблица `r table.num` - описательные статистики модели после исключения 2

```{r}
fit.11 <- lm(SREDDENDOXOD2012 ~ VRP2012 + Y.ORTorg.2012, 
            data = DF1)
kable(round(summary(fit.11)$coef, 4))
table.num <- table.num + 1
#summary(fit.11) # незначимые параметры
```

После исключения RKBS.2011 у нас не остались p-значения больше $\alpha$.


Значим только х2(Y.ORTorg.2012), х1(VRP2012).Коэффициент детерминации $R^2 =$ `r round(summary(fit.11)$r.sq, 3)`.

Явный вид модели 1: $SREDDENDOXOD2012 = 1,3199 + 0,5062 \cdot Y.ORTorg.2012+0,2133 \cdot VRP2012$.
```{r}
par(mfrow = c(1, 2))
plot(SREDDENDOXOD2012 ~  Y.ORTorg.2012+VRP2012, 
         data = DF1)
par(mfrow = c(1, 1))
pic.num <- pic.num + 1

```

#### Рис. `r pic.num`. график разброса исправленной логарифмированной модели

## Модель с переменной структурой по федеральным округам (логарифмированные данные).

Построим модель с переменной структурой, используя принадлежность каждого региона к одному из восьми федеральных округов.
Включим фиктивные переменные как в константу, так и в коэффициенты.
Общий вид модели с переменной структурой.

#### Таблица `r table.num` - описательные статистики логарифмированной модели по федеральным округам
```{r}

fit.11.fo <- lm(SREDDENDOXOD2012 ~ FO*(Y.ORTorg.2012+VRP2012), 
            data = DF1) 
kable(round(summary(fit.11.fo)$coef, 4))
table.num <- table.num + 1
#summary(fit.11.fo)
```

Модель в целом значима и скорректированный коэффициент
детерминации у неё высокий, чем у модели по всем регионам (`r round(summary(fit.11.fo)$r.sq, 3)*100`%). У неё есть незначимые параметры.
Исключать их последовательно вручную трудоёмко, поэтому мы воспользуемся пользовательской функцией, которая
проводит процедуру последовательного исключения регрессоров.

Сначала сгенерируем матрицу независимых переменных функцией
*model.matrix()*. После загружаем функцию для исключения незначимых регрессоров
из файла «removeFactorsByPValue.R» в рабочей директории и применяем её
к модели с переменной структурой.


### Модель без поправки:


#### Таблица `r table.num` - описательные статистики логарифмированной модели по федеральным округам без поправки
```{r}
# создаём фрейм со всеми переменными-факторами (создаём фиктивные)
X.matrix <- model.matrix(SREDDENDOXOD2012 ~ FO*(Y.ORTorg.2012+VRP2012), 
            data = DF1)  
            

# присоединяем независимую переменную
data.fit <- cbind(SREDDENDOXOD2012 = DF1$SREDDENDOXOD2012, 
                  data.frame(X.matrix)[, -1])

# сохраняем для следующей лабораторной
data.fit.11.fo <- data.fit

# функция с последовательным исключением незначимых регрессоров
source('https://raw.githubusercontent.com/aksyuk/R-Practice-basics/master/user_functions/removeFactorsByPValue.R')

# применяем процедуру, сначала без поправок на p-значения
fit.11.fo <- removeFactorsByPValue(data = data.fit, 
                                   y.var.name = 'SREDDENDOXOD2012')
kable(round(summary(fit.11.fo)$coef, 4))
table.num <- table.num + 1
#summary(fit.11.fo)

```
Все коэффициенты модели значимы и она имеет высокий уровень коэффициента детерминации. $R^2 =$ `r round(summary(fit.11.fo)$r.sq, 3)`.

Значимы константы для Приволжского, Северо-Западного,Уральского, Центрального, Южного , Северо-Кавказского и Северного федеральных
округов, коэффициент при VRP2012, а также коэффициенты при независимых переменных для некоторых округов. 

*(Y.ORTorg.2012 с Южным федеральным округом, с Северо-Западным федеральным округом, с Уральским федеральным округом, Центральным федеральным округом, Южным федеральным округом,;*
*VRP2012 с Северо-Западным и Уральским федеральными округами)*


### Модель с поправкой Бонферрони:


#### Таблица `r table.num` - описательные статистики логарифмированной модели по федеральным округам с поправкой Бонферрони
```{r}
# теперь с поправкой Бонферрони
fit.11.foB <- removeFactorsByPValue(data = data.fit, 
                                   y.var.name = 'SREDDENDOXOD2012',
                                   p.adj.method = 'bonferroni')
kable(round(summary(fit.11.foB)$coef, 4))
table.num <- table.num + 1
#summary(fit.11.foB)
```
Коэффициент модели при *VRP2012*,*FOСЗФО.Y.ORTorg.2012*,*FOУФО.Y.ORTorg.2012*,*FOСЗФО.VRP2012*,*FOУФО.VRP2012* значим, однако коэффициент детерминации заметно понизился ($R^2 =$ `r round(summary(fit.11.foB)$r.sq, 3)`).


## Сравнение моделей по качеству.

Сравним три полученные модели: изначальную, с поправкой и без поправки по ФО.

#### Таблица `r table.num` - сравнение двух логарифмированных моделей
```{r}
# модели с фактором KMPred.2013
#anova(fit.11,  fit.11.fo,fit.11.foB)

# список построенных моделей
models.list <- list(fit.11, fit.11.fo,fit.11.foB)
names(models.list) <- c('fit.11', 'fit.11.fo', 'fit.11.foB')

# фрейм с характеристиками четырёх моделей
df.goodness.of.fit <- data.frame(Модель = names(models.list), 
                                       R.2.скорр = 0,
                                       F.расч = 0,
                                       Станд.Ошибка = 0)
for (i in 1:length(models.list)) {
  # скорректированный R-квадрат
  df.goodness.of.fit[i, 'R.2.скорр'] <- 
    round(summary(models.list[[i]])$adj.r.squared, 3)
  # F расчётное
  df.goodness.of.fit[i, 'F.расч'] <- 
    round(summary(models.list[[i]])$fstatistic[1], 2)
  # стандартная ошибка
  df.goodness.of.fit[i, 'Станд.Ошибка'] <- 
    round(summary(models.list[[i]])$sigma, 3)
}
kable(df.goodness.of.fit)
table.num <- table.num + 1
#mean(DF1$SREDDENDOXOD2012) 
```

Результат: 

Среднее по Y = 9,899723 (~ 2% стандартной ошибки);

По столбцу $R^2$ больше всего подходит вторая модель;
По столбцу F.расч - первая;
По минимальной Стандартной ошибке - вторая, но при том, что у трех моделей она приблизительно похожа, выбор наилучшей становится сложнее.

При отношении F расчётного к $R^2$ скорректированному выбор падает на первую модель. Хоть её коэффициент детерминации ниже, чем у второй, но F в 4,2 раза больше.

**Явный вид модели 1: $SREDDENDOXOD2012 = 1,3199 + 0,5062 \cdot Y.ORTorg.2012+0,2133 \cdot VRP2012$.**


Сохраним нужные данные для дальнейших лабораторных работ.......
```{r}
# 4. Сохранение нужных объектов рабочего пространства  -------------------------
save(list = c('data.fit.1.fo', 'data.fit.11.fo','data.fit.x2.fo', 'fit.1.fo', 'fit.11.fo', 'DF', 'DF1', 'reg.df','fit.x2.fo','fit.x2.foB','fit.X2'), 
    file = 'test_lab2_Степанов.RData')
``` 
